<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <script>
    function createForm() {
        return `
            <form id="dynamicForm">
                <div id="questionsContainer"></div>
                <button id="submitButton" type="button" onclick="submitForm()">Submit</button>
            </form>
        `;
    }

    function getNextTuesdayAt10AM() {
        const now = new Date();
        const dayOfWeek = now.getDay(); // 0 = Sunday, 1 = Monday, ..., 6 = Saturday

        const daysUntilTuesday = (dayOfWeek <= 2) ? (2 - dayOfWeek) : (9 - dayOfWeek); // Days to next Tuesday
        const nextTuesday = new Date(now);
        
        nextTuesday.setDate(now.getDate() + daysUntilTuesday); // Move to next Tuesday
        nextTuesday.setHours(10, 0, 0, 0); //10:00 AM

        return nextTuesday;
    }

    function addDateTimeQuestion(label, objectName, defaultValue = getNextTuesdayAt10AM()) {
        const container = document.getElementById("questionsContainer");
        if (!container) {
            console.error("Form container not found.");
            return;
        }

        const questionId = objectName.replace(/\s+/g, "_").toLowerCase(); // Unique ID for the object

        const formattedDefault = defaultValue instanceof Date 
            ? formatLocalDateTime(defaultValue)
            : "";

        container.innerHTML += `
            <label for="${questionId}">${label}</label>
            <input type="datetime-local" id="${questionId}" name="${questionId}" value="${formattedDefault}">
            <br>
        `;
    }

    function formatLocalDateTime(date) {
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0'); // Months are 0-based
        const day = String(date.getDate()).padStart(2, '0');
        const hours = String(date.getHours()).padStart(2, '0');
        const minutes = String(date.getMinutes()).padStart(2, '0');
        
        return `${year}-${month}-${day}T${hours}:${minutes}`;
    }

    function addQuestion(label, objectName, defaultValue = "") {
        const container = document.getElementById("questionsContainer");
        if (!container) {
            console.error("Form container not found.");
            return;
        }

        const questionId = objectName.replace(/\s+/g, "_").toLowerCase(); // Unique ID for the object
        container.innerHTML += `
            <label for="${questionId}">${label}</label>
            <input type="text" id="${questionId}" name="${questionId}" value="${defaultValue}">
            <br>
        `;
    }

    function getNextSaturdayAt11AM() {
        const now = new Date();
        const dayOfWeek = now.getDay(); // 0 = Sunday, 1 = Monday, ..., 6 = Saturday

        const daysUntilSaturday = (dayOfWeek <= 6) ? (6 - dayOfWeek) : 7; // Days to NEXT Saturday
        const nextSaturday = new Date(now);
        
        nextSaturday.setDate(now.getDate() + daysUntilSaturday); // Move to next Saturday
        nextSaturday.setHours(11, 0, 0, 0); //11:00 AM

        return nextSaturday;
    }

    function submitForm() {
        const submitButton = document.getElementById("submitButton"); 
        submitButton.disabled = true; 

        const formElements = document.querySelectorAll("#questionsContainer input");
        const formData = {};

        formElements.forEach(input => {
            formData[input.name] = input.value;
        });

        google.script.run.withSuccessHandler(response => {
                    
        }).processAddDateData(formData.link, formData.date);
    }

    window.onload = function () {
        document.body.innerHTML = createForm();
        addQuestion("Form Link", "link");
        addDateTimeQuestion("When to close form?", "date", getNextTuesdayAt10AM());
    };
  </script>
</head>
<body>
</body>
</html>
